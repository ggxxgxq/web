{"remainingRequest":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/src/views/file/File.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/src/views/file/File.vue","mtime":1712587400026},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/cache-loader/dist/cjs.js","mtime":1712590523146},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/babel-loader/lib/index.js","mtime":1712590523266},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/cache-loader/dist/cjs.js","mtime":1712590523146},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/vue-loader/lib/index.js","mtime":1712590523434}],"contextDependencies":[],"result":["\n\nexport default {\n  name: 'File',\n  data() {\n    return {\n      menu: {\n        active: 'æœ€æ–°',\n        items: ['æœ€æ–°', 'æœ€çƒ­']\n      },\n      localStorage: '/api/local-storage/upload',\n      activeFileCategory: 'æ‰€æœ‰',\n      fileCategory: [{\n        name: 'æµ‹è¯•',\n        code: 'test'\n      }],\n      param: {\n        // æŸ¥è¯¢å‚æ•°\n        fileCategory: null,\n        general: null,\n        // page & order å‚æ•°\n        desc: 'create_time',\n        current: 1\n      },\n      filePage: {\n        'records': [\n          {\n            'id': 1,\n            'userId': 1,\n            'resourceId': 2,\n            'fileCategory': 'è®¡ç®—æœºç±»',\n            'title': 'è®¡ç®—æœºç±»å…¨å¥—PPTï¼Œä½ å€¼å¾—æ‹¥æœ‰',\n            'description': 'è®¡ç®—æœºç±»å…¨å¥—PPTï¼Œä½ å€¼å¾—æ‹¥æœ‰',\n            'name': 'ä¸­åŒ—å¤§å­¦è®¡ç®—æœºç±».ppt',\n            'size': '200MB',\n            'url': 'http://bkt.angus-liu.cn/ä¸­åŒ—å¤§å­¦è®¡ç®—æœºç±».ppt',\n            'downloadCount': 0,\n            'createTime': '2019-05-13 09:18:13',\n            'user': {\n              'id': 1,\n              'username': 'admin',\n              'nickname': 'ç®¡ç†å‘˜',\n              'avatar': 'http://img.angus-liu.cn/avatar/avatar07.png',\n              'sign': 'ä¸€å¥è¯ä»‹ç»è‡ªå·±'\n            },\n            'resource': {\n              'id': 2,\n              'zanCount': 0,\n              'pvCount': 0,\n              'commentCount': 0\n            }\n          }],\n        'total': 10,\n        'size': 10,\n        'current': 1,\n        'searchCount': true,\n        'pages': 1\n      },\n      fileAddModal: {\n        show: false,\n        form: {\n          fileCategory: '',\n          title: '',\n          description: '',\n          name: '',\n          size: '',\n          url: ''\n        }\n      },\n      commentList: [{\n        id: -1,\n        content: 'æµ‹è¯•è¯„è®º',\n        createTime: '2019-05-21 20:15:39',\n        postUser: {\n          id: -1,\n          username: 'admin',\n          nickname: 'ç®¡ç†å‘˜',\n          avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n        },\n        children: [\n          {\n            id: -2,\n            content: 'æµ‹è¯•å›å¤',\n            createTime: '2019-05-21 20:15:46',\n            postUser: {\n              id: 1,\n              username: 'admin',\n              nickname: 'ç®¡ç†å‘˜',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            },\n            replyUser: {\n              id: 1,\n              username: 'admin',\n              nickname: 'ç®¡ç†å‘˜',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            }\n          }\n        ]\n      }],\n      commentAddModal: {\n        show: false,\n        form: {\n          parentId: null,\n          resourceId: null,\n          replyUserId: null,\n          value: '',\n          content: ''\n        }\n      },\n      currentResource: {}\n    }\n  },\n  methods: {\n    // èœå•åˆ‡æ¢\n    select(item) {\n      this.menu.active = item;\n      if (item === 'æœ€æ–°') {\n        this.param.desc = 'create_time';\n      } else {\n        this.param.desc = 'download_count, comment_count, zan_count';\n      }\n      this.param.current = 1;\n      this.getFilePage(this.param);\n    },\n    // ç±»åˆ«åˆ‡æ¢\n    selectCategory(fileCategory) {\n      this.activeFileCategory = fileCategory;\n      if (fileCategory === 'æ‰€æœ‰') {\n        this.param.fileCategory = null;\n      } else {\n        this.param.fileCategory = fileCategory;\n      }\n      this.param.current = 1;\n      this.getFilePage(this.param);\n    },\n    // åˆå§‹åŒ–æ–‡ä»¶æ·»åŠ æ¨¡æ€æ¡†\n    resetFileAddModal() {\n      this.fileAddModal = {\n        show: false,\n        form: {\n          fileCategory: '',\n          title: '',\n          description: '',\n          name: '',\n          size: '',\n          url: ''\n        }\n      };\n      // æ¸…ç©ºå·²ä¸Šä¼ æ–‡ä»¶\n      this.$refs.upload.clearFiles();\n    },\n    // è·å–æ–‡ä»¶ç±»åˆ«\n    getFileCategory() {\n      this.$axios.get('/api/dic/item', { dicTypeCode: 'file-category' })\n        .then(res => {\n          let result = res.data;\n          this.fileCategory = result.data;\n        });\n    },\n    // è·å–æ–‡ä»¶åˆ†é¡µ\n    getFilePage(param) {\n      this.$axios.get('/api/file/page', param)\n        .then(res => {\n          let result = res.data;\n          this.filePage = result.data;\n        })\n    },\n    // æ ¹æ®æ–‡ä»¶åè·å–æ–‡ä»¶å›¾æ ‡æ ·å¼\n    getFileIcon(filename) {\n      let suffix = filename.substr(filename.lastIndexOf('.') + 1);\n      switch (suffix) {\n        case 'ppt':\n        case 'pptx':\n          return 'file powerpoint outline yellow';\n        case 'doc':\n        case 'docx':\n          return 'file word outline blue';\n        case 'xls':\n        case 'xlsx':\n          return 'file excel outline green';\n        case 'pdf':\n          return 'file pdf outline orange';\n        default:\n          return 'file alternate outline';\n      }\n    },\n    // æ–‡ä»¶ä¸Šä¼ å‰çš„å›è°ƒ\n    handleBeforeUpload() {\n      // é™åˆ¶ä¸Šä¼ æ–‡ä»¶æ•°é‡\n      if (this.$refs.upload.fileList.length > 0) {\n        this.$Notice.warning({ title: 'Warning', desc: 'ä¸€æ¬¡åªèƒ½ä¸Šä¼ ä¸€ä»½èµ„æ–™ï¼Œè‹¥è¦æ›´æ¢ï¼Œè¯·åˆ é™¤å·²ä¸Šä¼ æ–‡ä»¶' });\n        return false;\n      }\n      return true;\n    },\n    // æ–‡ä»¶ä¸Šä¼ æˆåŠŸæ—¶çš„å›è°ƒ\n    handleSuccess(res, file, fileList) {\n      let uploadInfo = res.data;\n      this.fileAddModal.form.name = uploadInfo.name;\n      this.fileAddModal.form.size = uploadInfo.size;\n      this.fileAddModal.form.url = uploadInfo.url;\n    },\n    // æ–‡ä»¶ä¸Šä¼ å¤±è´¥æ—¶çš„å›è°ƒ\n    handleError(err, res, file) {\n      this.$Notice.error({ title: 'Oops', desc: file.name + ' ä¸Šä¼ å¤±è´¥' });\n    },\n    // æ–‡ä»¶æ·»åŠ \n    addFile() {\n      this.$axios.post('/api/file', this.fileAddModal.form)\n        .then(res => {\n          let result = res.data;\n          if (result.success) {\n            this.$Notice.success({ title: 'Bingo', desc: 'åˆ†äº«æˆåŠŸ' });\n            this.resetFileAddModal();\n            this.getFilePage(this.param);\n          }\n        })\n    },\n    // æ–‡ä»¶ä¸‹è½½\n    downloadFile(file) {\n      this.$axios.put(`/api/file/${file.id}/download-count`)\n        .then(res => file.downloadCount++);\n    },\n    // ç‚¹èµ\n    addZan(resource) {\n      this.$axios.post('/api/zan', { resourceId: resource.id })\n        .then(res => resource.zanCount++);\n    },\n    // è·å–è¯„è®º\n    getCommentList(resource) {\n      this.currentResource = resource;\n      this.$axios.get(`/api/comment/${resource.id}`)\n        .then(res => {\n          let result = res.data;\n          this.commentList = result.data;\n          // å±•ç¤ºè¯„è®º\n          this.commentAddModal.show = true;\n        });\n    },\n    // åˆå§‹åŒ–è¯„è®º\n    initComment() {\n      this.commentAddModal.form = {\n        resourceId: null,\n        parentId: null,\n        replyUserId: null,\n        value: '',\n        content: ''\n      }\n    },\n    // æ·»åŠ è¯„è®º\n    addComment() {\n      // è®¾ç½®èµ„æº ID\n      this.commentAddModal.form.resourceId = this.currentResource.id;\n      // åˆ¤æ–­æ˜¯è¯„è®ºè¿˜æ˜¯å›å¤\n      if (this.commentAddModal.form.value.startsWith('@')\n        && this.commentAddModal.form.replyUserId !== null) {\n        // å›å¤æ—¶å»æ‰è¯„è®ºå†…å®¹ä¸­çš„å›å¤ç”¨æˆ·å\n        let index = this.commentAddModal.form.value.indexOf(' ');\n        this.commentAddModal.form.content = this.commentAddModal.form.value.substr(index + 1);\n      } else {\n        this.commentAddModal.form.parentId = null;\n        this.commentAddModal.form.replyUserId = null;\n        this.commentAddModal.form.content = this.commentAddModal.form.value;\n      }\n      this.$axios.post('/api/comment', this.commentAddModal.form)\n        .then(res => {\n          this.initComment();\n          this.currentResource.commentCount++;\n          this.getCommentList(this.currentResource);\n        });\n    },\n    // å›å¤è¯„è®º\n    replyComment(parentId, replyUser) {\n      this.commentAddModal.form.parentId = parentId;\n      this.commentAddModal.form.replyUserId = replyUser.id;\n      this.commentAddModal.form.value = `@${replyUser.nickname} `;\n      this.$refs.commentInput.focus();\n    },\n    // ä¸Šä¸€é¡µ\n    previousPage() {\n      this.param.current--;\n      this.getFilePage(this.param);\n      this.$refs.container.scrollIntoView();\n    },\n    // ä¸‹ä¸€é¡µ\n    nextPage() {\n      this.param.current++;\n      this.getFilePage(this.param);\n      this.$refs.container.scrollIntoView();\n    }\n  },\n  mounted() {\n    this.getFileCategory();\n    this.getFilePage(this.param);\n  }\n}\n",{"version":3,"sources":["File.vue"],"names":[],"mappings":";;AA+KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"File.vue","sourceRoot":"src/views/file","sourcesContent":["<template>\n  <div class=\"container\" ref=\"container\">\n    <Row>\n      <iCol span=\"17\">\n        <!-- æ–‡ä»¶æ“ä½œèœå• -->\n        <sui-menu>\n          <a is=\"sui-menu-item\" v-for=\"item in menu.items\" :key=\"item\" :content=\"item\"\n             :active=\"item === menu.active\" @click=\"select(item)\"/>\n          <sui-menu-item position=\"right\">\n            <sui-input transparent icon=\"search\" placeholder=\"æœç´¢\"\n                       v-model=\"param.general\" @keydown.enter=\"getFilePage(param)\"/>\n          </sui-menu-item>\n        </sui-menu>\n        <!-- æ–‡ä»¶æ“ä½œèœå• END -->\n        <!-- æ–‡ä»¶ç±»åˆ« -->\n        <div class=\"file-category\">\n          <Tag type=\"dot\" v-if=\"activeFileCategory === 'æ‰€æœ‰'\" color=\"#32C2BC\" @click.native=\"selectCategory('æ‰€æœ‰')\">æ‰€æœ‰\n          </Tag>\n          <Tag type=\"dot\" v-else @click.native=\"selectCategory('æ‰€æœ‰')\">æ‰€æœ‰</Tag>\n          <template v-for=\"item in fileCategory\">\n            <Tag type=\"dot\" v-if=\"item.name === activeFileCategory\" color=\"#32C2BC\"\n                 @click.native=\"selectCategory(item.name)\">\n              {{item.name}}\n            </Tag>\n            <Tag type=\"dot\" v-else @click.native=\"selectCategory(item.name)\">{{item.name}}</Tag>\n          </template>\n        </div>\n        <!-- æ–‡ä»¶ç±»åˆ« END -->\n        <!-- æ–‡ä»¶åˆ—è¡¨ -->\n        <sui-card class=\"fluid file-card\">\n          <sui-message attached=\"top\">æ–‡ä»¶åˆ—è¡¨</sui-message>\n          <sui-card-content>\n            <!-- æ–‡ä»¶é¡¹ -->\n            <sui-item-group>\n              <sui-item v-for=\"file in filePage.records\" :key=\"file.id\">\n                <sui-icon :name=\"getFileIcon(file.name)\"/>\n                <sui-item-content>\n                  <sui-item-header>\n                    <router-link :to=\"'/file/' + file.id\" style=\"color: #000;\">{{file.title}}</router-link>\n                    <sui-label basic color=\"teal\">{{file.fileCategory}}</sui-label>\n                  </sui-item-header>\n                  <sui-item-meta>\n                    <span class=\"file-user-nickname\">\n                      <router-link :to=\"'/user/' + file.user.id\" style=\"color: #555\">{{file.user.nickname}}</router-link>\n                    </span>\n                    <span class=\"file-create-time\"><Time :time=\"file.createTime\"/></span>\n                    <a :href=\"file.url\" :download=\"file.name\" @click=\"downloadFile(file)\">â¬ {{file.name}}</a>\n                  </sui-item-meta>\n                  <sui-item-description>\n                    <p>{{file.description}}</p>\n                  </sui-item-description>\n                  <sui-item-extra>\n                    <span class=\"file-size\">å¤§å°ï¼š{{file.size}}</span>\n                    <span class=\"file-download-count\">ä¸‹è½½ï¼š{{file.downloadCount}}</span>\n                    <span class=\"file-resource-zan-count\" @click=\"addZan(file.resource)\">\n                      ğŸ‘ {{file.resource.zanCount}}\n                    </span>\n                    <span class=\"file-resource-comment-count\" @click=\"getCommentList(file.resource)\">\n                      ğŸ’¬ {{file.resource.commentCount}}\n                    </span>\n                  </sui-item-extra>\n                </sui-item-content>\n              </sui-item>\n            </sui-item-group>\n            <!-- æ–‡ä»¶é¡¹ END -->\n          </sui-card-content>\n          <sui-button-group attached=\"bottom\" basic>\n            <sui-button content=\"ä¸Šä¸€é¡µ\" icon=\"left chevron\" label-position=\"left\" @click=\"previousPage\"\n                        :disabled=\"this.param.current <= 1\"/>\n            <sui-button-or/>\n            <sui-button content=\"ä¸‹ä¸€é¡µ\" icon=\"right chevron\" label-position=\"right\" @click=\"nextPage\"\n                        :disabled=\"this.param.current >= this.filePage.pages\"/>\n          </sui-button-group>\n        </sui-card>\n        <!-- æ–‡ä»¶åˆ—è¡¨ END -->\n      </iCol>\n      <iCol span=\"7\">\n        <!-- æ¶ˆæ¯æç¤º -->\n        <sui-message>\n          <sui-message-header>\n            <i class=\"handshake outline icon\"/> åˆ†äº«å­¦ä¹ èµ„æ–™ï¼Œè®©æ›´å¤šäººè·ç›Šã€‚\n          </sui-message-header>\n          <p style=\"text-align:justify\">\n            ä¸€ä¸ªäººç‹¬è¡Œå¯ä»¥èµ°å¾—å¾ˆå¿«ï¼Œä¸€ç¾¤äººæ‰ä¼šèµ°å¾—æ›´è¿œï¼æˆ‘ä»¬é¼“åŠ±å­¦ä¹ äº¤æµï¼Œæ›´é¼“åŠ±èµ„æºåˆ†äº«ã€‚\n            å¦‚æœæ‰‹é‡Œæœ‰æ¯”è¾ƒå¥½çš„å­¦ä¹ èµ„æ–™ï¼Œå¸Œæœ›ä½ èƒ½åˆ†äº«å‡ºæ¥ï¼Œè®©å¤§å®¶ä»ä¸­å—ç›Šã€‚\n            ä¸æ­¤åŒæ—¶ï¼Œä½ ä¹Ÿå°†ä¼šåœ¨è¿™ä¸ªå¹³å°ä¸Šæ‰¾åˆ°ä½ æ‰€éœ€è¦çš„å­¦ä¹ èµ„æ–™ã€‚â€œåˆ†äº«â€å¸®åŠ©ä½ æˆ‘æ¢ç´¢æ›´å¹¿é˜”çš„ä¸–ç•Œ ğŸ§\n          </p>\n          <sui-button fluid basic color=\"teal\" icon=\"upload\" content=\"ä¸Šä¼ æ–‡ä»¶\" @click=\"fileAddModal.show = true\"/>\n        </sui-message>\n        <!-- æ¶ˆæ¯æç¤º END -->\n      </iCol>\n    </Row>\n    <!-- æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† -->\n    <Modal v-model=\"fileAddModal.show\" title=\"ä¸Šä¼ æ–‡ä»¶\" width=\"600\" scrollable>\n      <Form :model=\"fileAddModal.form\" :label-width=\"50\">\n        <FormItem label=\"ç±»åˆ«\" required>\n          <Select v-model=\"fileAddModal.form.fileCategory\" size=\"large\">\n            <Option v-for=\"item in fileCategory\" :key=\"item.name\" :value=\"item.name\" :label=\"item.name\"/>\n          </Select>\n        </FormItem>\n        <FormItem label=\"æ ‡é¢˜\" required>\n          <Input v-model=\"fileAddModal.form.title\" size=\"large\" placeholder=\"é†’ç›®çš„æ ‡é¢˜èƒ½å¸å¼•æ›´å¤šäººä¸‹è½½\"/>\n        </FormItem>\n        <FormItem label=\"æè¿°\" required>\n          <Input v-model=\"fileAddModal.form.description\" type=\"textarea\" size=\"large\"\n                 :autosize=\"{minRows: 5,maxRows: 10}\" placeholder=\"ç®€çŸ­çš„æè¿°æœ‰åŠ©äºä»–äººäº†è§£èµ„æ–™çš„ç”¨é€”\"/>\n        </FormItem>\n        <FormItem label=\"æ–‡ä»¶\" required style=\"margin-bottom: 0\">\n          <Upload\n            ref=\"upload\"\n            type=\"drag\"\n            :action=\"localStorage\"\n            :data=\"{type: 'file'}\"\n            :before-upload=\"handleBeforeUpload\"\n            :on-success=\"handleSuccess\"\n            :on-error=\"handleError\">\n            <div style=\"padding: 20px 0\">\n              <Icon type=\"ios-cloud-upload\" size=\"52\" style=\"color: #32C2BC\"/>\n              <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶è¿›è¡Œä¸Šä¼ </p>\n            </div>\n          </Upload>\n        </FormItem>\n      </Form>\n      <template #footer>\n        <Button type=\"text\" @click=\"resetFileAddModal\">å–æ¶ˆ</Button>\n        <Button @click=\"addFile\">ç¡®å®šåˆ†äº«</Button>\n      </template>\n    </Modal>\n    <!-- æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† END -->\n    <!-- è¯„è®ºæ¨¡æ€æ¡† -->\n    <Modal v-model=\"commentAddModal.show\" title=\"å‘è¡¨è¯„è®º\" width=\"600\" footer-hide>\n      <Input ref=\"commentInput\" v-model=\"commentAddModal.form.value\" type=\"textarea\" :rows=\"3\" placeholder=\"æ·»åŠ è¯„è®º\"\n             @on-enter=\"addComment\"/>\n      <sui-comment-group class=\"comment-group\">\n        <sui-comment v-for=\"comment in commentList\" :key=\"comment.id\">\n          <sui-comment-avatar :src=\"comment.postUser.avatar\"/>\n          <sui-comment-content>\n            <a is=\"sui-comment-author\">{{comment.postUser.nickname}}</a>\n            <sui-comment-metadata>\n              <Time :time=\"comment.createTime\"/>\n            </sui-comment-metadata>\n            <sui-comment-text>{{comment.content}}</sui-comment-text>\n            <sui-comment-actions>\n              <sui-comment-action @click=\"replyComment(comment.id, comment.postUser)\">å›å¤</sui-comment-action>\n            </sui-comment-actions>\n          </sui-comment-content>\n          <!-- å­è¯„è®º -->\n          <sui-comment-group v-if=\"comment.children.length > 0\">\n            <sui-comment v-for=\"child in comment.children\" :key=\"child.id\">\n              <sui-comment-avatar :src=\"child.postUser.avatar\"/>\n              <sui-comment-content>\n                <a is=\"sui-comment-author\">{{child.postUser.nickname}}</a>\n                <sui-comment-metadata>\n                  <Time :time=\"child.createTime\"/>\n                </sui-comment-metadata>\n                <sui-comment-text>\n                  <a :href=\"child.replyUser.id\">@{{child.replyUser.nickname}}</a>\n                  {{child.content}}\n                </sui-comment-text>\n                <sui-comment-actions>\n                  <sui-comment-action @click=\"replyComment(comment.id, child.postUser)\">å›å¤</sui-comment-action>\n                </sui-comment-actions>\n              </sui-comment-content>\n            </sui-comment>\n          </sui-comment-group>\n          <!-- å­è¯„è®º END -->\n        </sui-comment>\n      </sui-comment-group>\n    </Modal>\n    <!-- è¯„è®ºæ¨¡æ€æ¡† END -->\n  </div>\n</template>\n\n<script>\n\nexport default {\n  name: 'File',\n  data() {\n    return {\n      menu: {\n        active: 'æœ€æ–°',\n        items: ['æœ€æ–°', 'æœ€çƒ­']\n      },\n      localStorage: '/api/local-storage/upload',\n      activeFileCategory: 'æ‰€æœ‰',\n      fileCategory: [{\n        name: 'æµ‹è¯•',\n        code: 'test'\n      }],\n      param: {\n        // æŸ¥è¯¢å‚æ•°\n        fileCategory: null,\n        general: null,\n        // page & order å‚æ•°\n        desc: 'create_time',\n        current: 1\n      },\n      filePage: {\n        'records': [\n          {\n            'id': 1,\n            'userId': 1,\n            'resourceId': 2,\n            'fileCategory': 'è®¡ç®—æœºç±»',\n            'title': 'è®¡ç®—æœºç±»å…¨å¥—PPTï¼Œä½ å€¼å¾—æ‹¥æœ‰',\n            'description': 'è®¡ç®—æœºç±»å…¨å¥—PPTï¼Œä½ å€¼å¾—æ‹¥æœ‰',\n            'name': 'ä¸­åŒ—å¤§å­¦è®¡ç®—æœºç±».ppt',\n            'size': '200MB',\n            'url': 'http://bkt.angus-liu.cn/ä¸­åŒ—å¤§å­¦è®¡ç®—æœºç±».ppt',\n            'downloadCount': 0,\n            'createTime': '2019-05-13 09:18:13',\n            'user': {\n              'id': 1,\n              'username': 'admin',\n              'nickname': 'ç®¡ç†å‘˜',\n              'avatar': 'http://img.angus-liu.cn/avatar/avatar07.png',\n              'sign': 'ä¸€å¥è¯ä»‹ç»è‡ªå·±'\n            },\n            'resource': {\n              'id': 2,\n              'zanCount': 0,\n              'pvCount': 0,\n              'commentCount': 0\n            }\n          }],\n        'total': 10,\n        'size': 10,\n        'current': 1,\n        'searchCount': true,\n        'pages': 1\n      },\n      fileAddModal: {\n        show: false,\n        form: {\n          fileCategory: '',\n          title: '',\n          description: '',\n          name: '',\n          size: '',\n          url: ''\n        }\n      },\n      commentList: [{\n        id: -1,\n        content: 'æµ‹è¯•è¯„è®º',\n        createTime: '2019-05-21 20:15:39',\n        postUser: {\n          id: -1,\n          username: 'admin',\n          nickname: 'ç®¡ç†å‘˜',\n          avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n        },\n        children: [\n          {\n            id: -2,\n            content: 'æµ‹è¯•å›å¤',\n            createTime: '2019-05-21 20:15:46',\n            postUser: {\n              id: 1,\n              username: 'admin',\n              nickname: 'ç®¡ç†å‘˜',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            },\n            replyUser: {\n              id: 1,\n              username: 'admin',\n              nickname: 'ç®¡ç†å‘˜',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            }\n          }\n        ]\n      }],\n      commentAddModal: {\n        show: false,\n        form: {\n          parentId: null,\n          resourceId: null,\n          replyUserId: null,\n          value: '',\n          content: ''\n        }\n      },\n      currentResource: {}\n    }\n  },\n  methods: {\n    // èœå•åˆ‡æ¢\n    select(item) {\n      this.menu.active = item;\n      if (item === 'æœ€æ–°') {\n        this.param.desc = 'create_time';\n      } else {\n        this.param.desc = 'download_count, comment_count, zan_count';\n      }\n      this.param.current = 1;\n      this.getFilePage(this.param);\n    },\n    // ç±»åˆ«åˆ‡æ¢\n    selectCategory(fileCategory) {\n      this.activeFileCategory = fileCategory;\n      if (fileCategory === 'æ‰€æœ‰') {\n        this.param.fileCategory = null;\n      } else {\n        this.param.fileCategory = fileCategory;\n      }\n      this.param.current = 1;\n      this.getFilePage(this.param);\n    },\n    // åˆå§‹åŒ–æ–‡ä»¶æ·»åŠ æ¨¡æ€æ¡†\n    resetFileAddModal() {\n      this.fileAddModal = {\n        show: false,\n        form: {\n          fileCategory: '',\n          title: '',\n          description: '',\n          name: '',\n          size: '',\n          url: ''\n        }\n      };\n      // æ¸…ç©ºå·²ä¸Šä¼ æ–‡ä»¶\n      this.$refs.upload.clearFiles();\n    },\n    // è·å–æ–‡ä»¶ç±»åˆ«\n    getFileCategory() {\n      this.$axios.get('/api/dic/item', { dicTypeCode: 'file-category' })\n        .then(res => {\n          let result = res.data;\n          this.fileCategory = result.data;\n        });\n    },\n    // è·å–æ–‡ä»¶åˆ†é¡µ\n    getFilePage(param) {\n      this.$axios.get('/api/file/page', param)\n        .then(res => {\n          let result = res.data;\n          this.filePage = result.data;\n        })\n    },\n    // æ ¹æ®æ–‡ä»¶åè·å–æ–‡ä»¶å›¾æ ‡æ ·å¼\n    getFileIcon(filename) {\n      let suffix = filename.substr(filename.lastIndexOf('.') + 1);\n      switch (suffix) {\n        case 'ppt':\n        case 'pptx':\n          return 'file powerpoint outline yellow';\n        case 'doc':\n        case 'docx':\n          return 'file word outline blue';\n        case 'xls':\n        case 'xlsx':\n          return 'file excel outline green';\n        case 'pdf':\n          return 'file pdf outline orange';\n        default:\n          return 'file alternate outline';\n      }\n    },\n    // æ–‡ä»¶ä¸Šä¼ å‰çš„å›è°ƒ\n    handleBeforeUpload() {\n      // é™åˆ¶ä¸Šä¼ æ–‡ä»¶æ•°é‡\n      if (this.$refs.upload.fileList.length > 0) {\n        this.$Notice.warning({ title: 'Warning', desc: 'ä¸€æ¬¡åªèƒ½ä¸Šä¼ ä¸€ä»½èµ„æ–™ï¼Œè‹¥è¦æ›´æ¢ï¼Œè¯·åˆ é™¤å·²ä¸Šä¼ æ–‡ä»¶' });\n        return false;\n      }\n      return true;\n    },\n    // æ–‡ä»¶ä¸Šä¼ æˆåŠŸæ—¶çš„å›è°ƒ\n    handleSuccess(res, file, fileList) {\n      let uploadInfo = res.data;\n      this.fileAddModal.form.name = uploadInfo.name;\n      this.fileAddModal.form.size = uploadInfo.size;\n      this.fileAddModal.form.url = uploadInfo.url;\n    },\n    // æ–‡ä»¶ä¸Šä¼ å¤±è´¥æ—¶çš„å›è°ƒ\n    handleError(err, res, file) {\n      this.$Notice.error({ title: 'Oops', desc: file.name + ' ä¸Šä¼ å¤±è´¥' });\n    },\n    // æ–‡ä»¶æ·»åŠ \n    addFile() {\n      this.$axios.post('/api/file', this.fileAddModal.form)\n        .then(res => {\n          let result = res.data;\n          if (result.success) {\n            this.$Notice.success({ title: 'Bingo', desc: 'åˆ†äº«æˆåŠŸ' });\n            this.resetFileAddModal();\n            this.getFilePage(this.param);\n          }\n        })\n    },\n    // æ–‡ä»¶ä¸‹è½½\n    downloadFile(file) {\n      this.$axios.put(`/api/file/${file.id}/download-count`)\n        .then(res => file.downloadCount++);\n    },\n    // ç‚¹èµ\n    addZan(resource) {\n      this.$axios.post('/api/zan', { resourceId: resource.id })\n        .then(res => resource.zanCount++);\n    },\n    // è·å–è¯„è®º\n    getCommentList(resource) {\n      this.currentResource = resource;\n      this.$axios.get(`/api/comment/${resource.id}`)\n        .then(res => {\n          let result = res.data;\n          this.commentList = result.data;\n          // å±•ç¤ºè¯„è®º\n          this.commentAddModal.show = true;\n        });\n    },\n    // åˆå§‹åŒ–è¯„è®º\n    initComment() {\n      this.commentAddModal.form = {\n        resourceId: null,\n        parentId: null,\n        replyUserId: null,\n        value: '',\n        content: ''\n      }\n    },\n    // æ·»åŠ è¯„è®º\n    addComment() {\n      // è®¾ç½®èµ„æº ID\n      this.commentAddModal.form.resourceId = this.currentResource.id;\n      // åˆ¤æ–­æ˜¯è¯„è®ºè¿˜æ˜¯å›å¤\n      if (this.commentAddModal.form.value.startsWith('@')\n        && this.commentAddModal.form.replyUserId !== null) {\n        // å›å¤æ—¶å»æ‰è¯„è®ºå†…å®¹ä¸­çš„å›å¤ç”¨æˆ·å\n        let index = this.commentAddModal.form.value.indexOf(' ');\n        this.commentAddModal.form.content = this.commentAddModal.form.value.substr(index + 1);\n      } else {\n        this.commentAddModal.form.parentId = null;\n        this.commentAddModal.form.replyUserId = null;\n        this.commentAddModal.form.content = this.commentAddModal.form.value;\n      }\n      this.$axios.post('/api/comment', this.commentAddModal.form)\n        .then(res => {\n          this.initComment();\n          this.currentResource.commentCount++;\n          this.getCommentList(this.currentResource);\n        });\n    },\n    // å›å¤è¯„è®º\n    replyComment(parentId, replyUser) {\n      this.commentAddModal.form.parentId = parentId;\n      this.commentAddModal.form.replyUserId = replyUser.id;\n      this.commentAddModal.form.value = `@${replyUser.nickname} `;\n      this.$refs.commentInput.focus();\n    },\n    // ä¸Šä¸€é¡µ\n    previousPage() {\n      this.param.current--;\n      this.getFilePage(this.param);\n      this.$refs.container.scrollIntoView();\n    },\n    // ä¸‹ä¸€é¡µ\n    nextPage() {\n      this.param.current++;\n      this.getFilePage(this.param);\n      this.$refs.container.scrollIntoView();\n    }\n  },\n  mounted() {\n    this.getFileCategory();\n    this.getFilePage(this.param);\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.container {\n  width: 1200px;\n  margin: 10px auto;\n\n  .ivu-col {\n    padding: 7px;\n  }\n\n  .file-category {\n    .ivu-tag {\n      border: 1px solid rgba(34, 36, 38, .15);\n      box-shadow: 0 1px 2px 0 rgba(34, 36, 38, .15);\n    }\n  }\n\n  .card {\n    .items {\n      padding: 0 10px;\n\n      .item {\n        margin: 20px 0;\n        padding-bottom: 10px;\n        border-bottom: 1px dashed #ddd;\n\n        .header {\n          line-height: 30px;\n        }\n\n        i {\n          font-size: 5em;\n          line-height: 1;\n          vertical-align: middle;\n        }\n      }\n\n      .item:last-child {\n        padding-bottom: 0;\n        border-bottom: none;\n      }\n    }\n  }\n\n  ul {\n    list-style: none;\n\n    li {\n      display: inline-block;\n      margin-right: 15px;\n      color: #546a7e;\n    }\n  }\n\n  .file-card {\n    .file-user-nickname,\n    .file-create-time,\n    .file-size,\n    .file-download-count,\n    .file-resource-zan-count,\n    .file-resource-comment-count {\n      display: inline-block;\n      width: 150px;\n    }\n\n    .file-resource-zan-count,\n    .file-resource-comment-count {\n      width: 60px;\n      cursor: pointer;\n    }\n\n    .file-resource-zan-count:hover,\n    .file-resource-comment-count:hover {\n      color: #000;\n    }\n  }\n}\n\n.comment-group {\n  max-height: 600px;\n  overflow: auto;\n}\n</style>\n"]}]}