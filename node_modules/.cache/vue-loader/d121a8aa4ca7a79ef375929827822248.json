{"remainingRequest":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/src/views/moment/Moment.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/src/views/moment/Moment.vue","mtime":1712673875733},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/cache-loader/dist/cjs.js","mtime":1712590523146},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/babel-loader/lib/index.js","mtime":1712590523266},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/cache-loader/dist/cjs.js","mtime":1712590523146},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/vue-loader/lib/index.js","mtime":1712590523434}],"contextDependencies":[],"result":["\nimport ImageUploader from '@/components/common/ImageUploader'\n\nexport default {\n  name: 'Moment',\n  components: {\n    ImageUploader\n  },\n  data() {\n    return {\n      menu: {\n        active: '最新',\n        items: ['最新', '最热']\n      },\n      param: {\n        // page & order 参数\n        desc: 'create_time',\n        size: 20,\n        current: 1\n      },\n      momentPage: {\n        'records': [{\n          'id': 1,\n          'userId': 1,\n          'resourceId': 2,\n          'momentCategory': '校园动态',\n          'content': '校园动态测试',\n          'createTime': '2024-05-15 16:23:50',\n          'images': ['http://img.angus-liu.cn/avatar/avatar01.jpg', 'http://img.angus-liu.cn/avatar/avatar03.jpg'],\n          'user': {\n            'id': 1,\n            'username': 'admin',\n            'nickname': '管理员',\n            'avatar': 'http://img.angus-liu.cn/avatar/avatar07.png',\n            'sign': '一句话介绍自己'\n          },\n          'resource': {\n            'id': 2,\n            'zanCount': 0,\n            'pvCount': 0,\n            'commentCount': 0\n          }\n        }],\n        'total': 18,\n        'size': 10,\n        'current': 1,\n        'searchCount': true,\n        'pages': 2\n      },\n      momentAddModal: {\n        show: false,\n        form: {\n          momentCategory: '校园动态',\n          content: '',\n          images: []\n        }\n      },\n      currentResource: {},\n      commentList: [{\n        id: -1,\n        content: '测试评论',\n        createTime: '2024-05-21 20:15:39',\n        postUser: {\n          id: -1,\n          username: 'admin',\n          nickname: '管理员',\n          avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n        },\n        children: [\n          {\n            id: -2,\n            content: '测试回复',\n            createTime: '2024-05-21 20:15:46',\n            postUser: {\n              id: 1,\n              username: 'admin',\n              nickname: '管理员',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            },\n            replyUser: {\n              id: 1,\n              username: 'admin',\n              nickname: '管理员',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            }\n          }\n        ]\n      }],\n      commentAddModal: {\n        show: false,\n        form: {\n          parentId: null,\n          resourceId: null,\n          replyUserId: null,\n          value: '',\n          content: ''\n        }\n      },\n    }\n  },\n  methods: {\n    // 重置动态添加模态框\n    resetMomentAddModal() {\n      this.$refs.imageUploader.clearImages();\n      this.momentAddModal = {\n        show: false,\n        form: {\n          momentCategory: '校园动态',\n          content: '',\n          images: []\n        }\n      };\n    },\n    // 切换菜单\n    select(item) {\n      this.menu.active = item;\n      if (item === '最新') {\n        this.param.desc = 'create_time';\n      } else {\n        this.param.desc = 'comment_count,zan_count';\n      }\n      this.param.current = 1;\n      // 重新获取数据\n      this.getMomentPage(this.param)\n    },\n    // 获取动态分页\n    getMomentPage(param) {\n      this.$axios.get('/api/moment/page', param)\n        .then(res => {\n          let result = res.data;\n          this.momentPage = result.data;\n          this.momentPage.records.forEach(moment => {\n            if (moment.images && moment.images.length > 0) {\n              moment.images = JSON.parse(moment.images);\n            }\n          })\n        });\n    },\n    // 动态添加\n    addMoment() {\n      let momentAddForm = this.momentAddModal.form;\n      momentAddForm.images = JSON.stringify(momentAddForm.images);\n      this.$axios.post('/api/moment', momentAddForm)\n        .then(res => {\n          let result = res.data;\n          if (result.success) {\n            this.$Notice.success({ title: 'Bingo', desc: '发布成功' });\n            this.resetMomentAddModal();\n            this.getMomentPage(this.param);\n          }\n        })\n    },\n    // 加载更多\n    loadMore() {\n      this.param.current++;\n      this.$axios.get('/api/moment/page', this.param)\n        .then(res => {\n          let result = res.data;\n          let morePage = result.data;\n          morePage.records.forEach(moment => {\n            if (moment.images && moment.images.length > 0) {\n              moment.images = JSON.parse(moment.images);\n            }\n          });\n          this.momentPage.records.push(...morePage.records);\n        });\n    },\n    // 点赞\n    addZan(resource) {\n      this.$axios.post('/api/zan', { resourceId: resource.id })\n        .then(res => resource.zanCount++);\n    },\n    // 获取评论\n    getCommentList(resource) {\n      this.currentResource = resource;\n      this.$axios.get(`/api/comment/${resource.id}`)\n        .then(res => {\n          let result = res.data;\n          this.commentList = result.data;\n          // 展示评论\n          this.commentAddModal.show = true;\n        });\n    },\n    // 初始化评论\n    initComment() {\n      this.commentAddModal.form = {\n        resourceId: null,\n        parentId: null,\n        replyUserId: null,\n        value: '',\n        content: ''\n      }\n    },\n    // 添加评论\n    addComment() {\n      // 设置资源 ID\n      this.commentAddModal.form.resourceId = this.currentResource.id;\n      // 判断是评论还是回复\n      if (this.commentAddModal.form.value.startsWith('@')\n        && this.commentAddModal.form.replyUserId !== null) {\n        // 回复时去掉评论内容中的回复用户名\n        let index = this.commentAddModal.form.value.indexOf(' ');\n        this.commentAddModal.form.content = this.commentAddModal.form.value.substr(index + 1);\n      } else {\n        this.commentAddModal.form.parentId = null;\n        this.commentAddModal.form.replyUserId = null;\n        this.commentAddModal.form.content = this.commentAddModal.form.value;\n      }\n      this.$axios.post('/api/comment', this.commentAddModal.form)\n        .then(res => {\n          this.initComment();\n          this.currentResource.commentCount++;\n          this.getCommentList(this.currentResource);\n        });\n    },\n    // 回复评论\n    replyComment(parentId, replyUser) {\n      this.commentAddModal.form.parentId = parentId;\n      this.commentAddModal.form.replyUserId = replyUser.id;\n      this.commentAddModal.form.value = `@${replyUser.nickname} `;\n      this.$refs.commentInput.focus();\n    },\n  },\n  mounted() {\n    this.getMomentPage(this.param);\n  }\n}\n",{"version":3,"sources":["Moment.vue"],"names":[],"mappings":";AAuHA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Moment.vue","sourceRoot":"src/views/moment","sourcesContent":["<template>\n  <div class=\"container\">\n    <!-- 消息提示 -->\n    <sui-message info dismissable>\n      <sui-message-header>如何发表动态？</sui-message-header>\n      <p>\n        成功登录 Smilcool 系统后，点击下方 “发布动态” 按钮即可发表动态啦。快来发布你的校园动态吧 😆\n      </p>\n    </sui-message>\n    <!-- 消息提示 END -->\n    <!-- 动态菜单栏 -->\n    <sui-menu pointing>\n      <a is=\"sui-menu-item\" v-for=\"item in menu.items\" :key=\"item\" :content=\"item\" :active=\"item === menu.active\"\n         @click=\"select(item)\"/>\n      <sui-menu-menu position=\"right\">\n        <sui-button basic attached=\"right\" icon=\"paper plane outline\" content=\"发布动态\"\n                    @click=\"momentAddModal.show = true\"/>\n      </sui-menu-menu>\n    </sui-menu>\n    <!-- 动态菜单栏 END -->\n    <!-- 动态列表 -->\n    <div class=\"moment-list\">\n      <sui-card class=\"fluid moment-item\" v-for=\"moment in momentPage.records\" :key=\"moment.id\">\n        <sui-card-content class=\"moment-item-wrapper\">\n          <sui-card-header class=\"moment-header\">\n            <sui-image class=\"moment-avatar\" :src=\"moment.user.avatar\" circular/>\n            <span style=\"margin-left:5px; font-size: 16px\">{{moment.user.nickname}}</span>\n            <sui-button class=\"right floated\" size=\"mini\" basic positive>关注</sui-button>\n          </sui-card-header>\n          <sui-card-meta class=\"moment-time\">\n            <Time :time=\"moment.createTime\"/>\n          </sui-card-meta>\n          <sui-card-description class=\"moment-content\">\n            <p>{{moment.content}}</p>\n            <sui-image-group class=\"moment-image-group\" v-if=\"moment.images && moment.images.length > 0\" size=\"tiny\">\n              <sui-image v-for=\"(image, index) in moment.images\" :key=\"index\" :src=\"image\"/>\n            </sui-image-group>\n          </sui-card-description>\n        </sui-card-content>\n        <sui-card-content extra>\n          <template #right>\n            <a is=\"sui-label\" basic @click=\"addZan(moment.resource)\">👍 {{moment.resource.zanCount}}</a>\n            <a is=\"sui-label\" basic @click=\"getCommentList(moment.resource)\">💬 {{moment.resource.commentCount}}</a>\n          </template>\n        </sui-card-content>\n      </sui-card>\n    </div>\n    <!-- 动态列表 END -->\n    <!-- 加载更多 -->\n    <sui-button class=\"fluid\" color=\"grey\" basic content=\"加载更多\" @click=\"loadMore\"\n                :disabled=\"param.current >= momentPage.pages\"/>\n    <!-- 加载更多 END -->\n    <!-- 发布动态模态框 -->\n    <Modal v-model=\"momentAddModal.show\" title=\"发布动态\" width=\"600\" scrollable>\n      <Form :model=\"momentAddModal.form\" :label-width=\"50\">\n        <FormItem label=\"类别\" required>\n          <Select v-model=\"momentAddModal.form.momentCategory\" size=\"large\">\n            <Option value=\"校园动态\">校园动态</Option>\n          </Select>\n        </FormItem>\n        <FormItem label=\"内容\" required>\n          <Input v-model=\"momentAddModal.form.content\" type=\"textarea\" size=\"large\" :autosize=\"{minRows: 5,maxRows: 10}\"\n                 placeholder=\"输入你发现的趣事吧~\"/>\n        </FormItem>\n        <FormItem label=\"图片\" style=\"margin-bottom: 0\">\n          <ImageUploader ref=\"imageUploader\" @images-change=\"images => momentAddModal.form.images = images\"/>\n        </FormItem>\n      </Form>\n      <template #footer>\n        <Button type=\"text\" @click=\"resetMomentAddModal\">取消</Button>\n        <Button @click=\"addMoment\">确定发布</Button>\n      </template>\n    </Modal>\n    <!-- 发布动态模态框 END -->\n    <!-- 评论模态框 -->\n    <Modal v-model=\"commentAddModal.show\" title=\"发表评论\" width=\"600\" footer-hide>\n      <Input ref=\"commentInput\" v-model=\"commentAddModal.form.value\" type=\"textarea\" :rows=\"3\" placeholder=\"添加评论\"\n             @on-enter=\"addComment\"/>\n      <sui-comment-group class=\"comment-group\">\n        <sui-comment v-for=\"comment in commentList\" :key=\"comment.id\">\n          <sui-comment-avatar :src=\"comment.postUser.avatar\"/>\n          <sui-comment-content>\n            <a is=\"sui-comment-author\">{{comment.postUser.nickname}}</a>\n            <sui-comment-metadata>\n              <Time :time=\"comment.createTime\"/>\n            </sui-comment-metadata>\n            <sui-comment-text>{{comment.content}}</sui-comment-text>\n            <sui-comment-actions>\n              <sui-comment-action @click=\"replyComment(comment.id, comment.postUser)\">回复</sui-comment-action>\n            </sui-comment-actions>\n          </sui-comment-content>\n          <!-- 子评论 -->\n          <sui-comment-group v-if=\"comment.children.length > 0\">\n            <sui-comment v-for=\"child in comment.children\" :key=\"child.id\">\n              <sui-comment-avatar :src=\"child.postUser.avatar\"/>\n              <sui-comment-content>\n                <a is=\"sui-comment-author\">{{child.postUser.nickname}}</a>\n                <sui-comment-metadata>\n                  <Time :time=\"child.createTime\"/>\n                </sui-comment-metadata>\n                <sui-comment-text>\n                  <a :href=\"child.replyUser.id\">@{{child.replyUser.nickname}}</a>\n                  {{child.content}}\n                </sui-comment-text>\n                <sui-comment-actions>\n                  <sui-comment-action @click=\"replyComment(comment.id, child.postUser)\">回复</sui-comment-action>\n                </sui-comment-actions>\n              </sui-comment-content>\n            </sui-comment>\n          </sui-comment-group>\n          <!-- 子评论 END -->\n        </sui-comment>\n      </sui-comment-group>\n    </Modal>\n    <!-- 评论模态框 END -->\n  </div>\n</template>\n\n<script>\nimport ImageUploader from '@/components/common/ImageUploader'\n\nexport default {\n  name: 'Moment',\n  components: {\n    ImageUploader\n  },\n  data() {\n    return {\n      menu: {\n        active: '最新',\n        items: ['最新', '最热']\n      },\n      param: {\n        // page & order 参数\n        desc: 'create_time',\n        size: 20,\n        current: 1\n      },\n      momentPage: {\n        'records': [{\n          'id': 1,\n          'userId': 1,\n          'resourceId': 2,\n          'momentCategory': '校园动态',\n          'content': '校园动态测试',\n          'createTime': '2024-05-15 16:23:50',\n          'images': ['http://img.angus-liu.cn/avatar/avatar01.jpg', 'http://img.angus-liu.cn/avatar/avatar03.jpg'],\n          'user': {\n            'id': 1,\n            'username': 'admin',\n            'nickname': '管理员',\n            'avatar': 'http://img.angus-liu.cn/avatar/avatar07.png',\n            'sign': '一句话介绍自己'\n          },\n          'resource': {\n            'id': 2,\n            'zanCount': 0,\n            'pvCount': 0,\n            'commentCount': 0\n          }\n        }],\n        'total': 18,\n        'size': 10,\n        'current': 1,\n        'searchCount': true,\n        'pages': 2\n      },\n      momentAddModal: {\n        show: false,\n        form: {\n          momentCategory: '校园动态',\n          content: '',\n          images: []\n        }\n      },\n      currentResource: {},\n      commentList: [{\n        id: -1,\n        content: '测试评论',\n        createTime: '2024-05-21 20:15:39',\n        postUser: {\n          id: -1,\n          username: 'admin',\n          nickname: '管理员',\n          avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n        },\n        children: [\n          {\n            id: -2,\n            content: '测试回复',\n            createTime: '2024-05-21 20:15:46',\n            postUser: {\n              id: 1,\n              username: 'admin',\n              nickname: '管理员',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            },\n            replyUser: {\n              id: 1,\n              username: 'admin',\n              nickname: '管理员',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            }\n          }\n        ]\n      }],\n      commentAddModal: {\n        show: false,\n        form: {\n          parentId: null,\n          resourceId: null,\n          replyUserId: null,\n          value: '',\n          content: ''\n        }\n      },\n    }\n  },\n  methods: {\n    // 重置动态添加模态框\n    resetMomentAddModal() {\n      this.$refs.imageUploader.clearImages();\n      this.momentAddModal = {\n        show: false,\n        form: {\n          momentCategory: '校园动态',\n          content: '',\n          images: []\n        }\n      };\n    },\n    // 切换菜单\n    select(item) {\n      this.menu.active = item;\n      if (item === '最新') {\n        this.param.desc = 'create_time';\n      } else {\n        this.param.desc = 'comment_count,zan_count';\n      }\n      this.param.current = 1;\n      // 重新获取数据\n      this.getMomentPage(this.param)\n    },\n    // 获取动态分页\n    getMomentPage(param) {\n      this.$axios.get('/api/moment/page', param)\n        .then(res => {\n          let result = res.data;\n          this.momentPage = result.data;\n          this.momentPage.records.forEach(moment => {\n            if (moment.images && moment.images.length > 0) {\n              moment.images = JSON.parse(moment.images);\n            }\n          })\n        });\n    },\n    // 动态添加\n    addMoment() {\n      let momentAddForm = this.momentAddModal.form;\n      momentAddForm.images = JSON.stringify(momentAddForm.images);\n      this.$axios.post('/api/moment', momentAddForm)\n        .then(res => {\n          let result = res.data;\n          if (result.success) {\n            this.$Notice.success({ title: 'Bingo', desc: '发布成功' });\n            this.resetMomentAddModal();\n            this.getMomentPage(this.param);\n          }\n        })\n    },\n    // 加载更多\n    loadMore() {\n      this.param.current++;\n      this.$axios.get('/api/moment/page', this.param)\n        .then(res => {\n          let result = res.data;\n          let morePage = result.data;\n          morePage.records.forEach(moment => {\n            if (moment.images && moment.images.length > 0) {\n              moment.images = JSON.parse(moment.images);\n            }\n          });\n          this.momentPage.records.push(...morePage.records);\n        });\n    },\n    // 点赞\n    addZan(resource) {\n      this.$axios.post('/api/zan', { resourceId: resource.id })\n        .then(res => resource.zanCount++);\n    },\n    // 获取评论\n    getCommentList(resource) {\n      this.currentResource = resource;\n      this.$axios.get(`/api/comment/${resource.id}`)\n        .then(res => {\n          let result = res.data;\n          this.commentList = result.data;\n          // 展示评论\n          this.commentAddModal.show = true;\n        });\n    },\n    // 初始化评论\n    initComment() {\n      this.commentAddModal.form = {\n        resourceId: null,\n        parentId: null,\n        replyUserId: null,\n        value: '',\n        content: ''\n      }\n    },\n    // 添加评论\n    addComment() {\n      // 设置资源 ID\n      this.commentAddModal.form.resourceId = this.currentResource.id;\n      // 判断是评论还是回复\n      if (this.commentAddModal.form.value.startsWith('@')\n        && this.commentAddModal.form.replyUserId !== null) {\n        // 回复时去掉评论内容中的回复用户名\n        let index = this.commentAddModal.form.value.indexOf(' ');\n        this.commentAddModal.form.content = this.commentAddModal.form.value.substr(index + 1);\n      } else {\n        this.commentAddModal.form.parentId = null;\n        this.commentAddModal.form.replyUserId = null;\n        this.commentAddModal.form.content = this.commentAddModal.form.value;\n      }\n      this.$axios.post('/api/comment', this.commentAddModal.form)\n        .then(res => {\n          this.initComment();\n          this.currentResource.commentCount++;\n          this.getCommentList(this.currentResource);\n        });\n    },\n    // 回复评论\n    replyComment(parentId, replyUser) {\n      this.commentAddModal.form.parentId = parentId;\n      this.commentAddModal.form.replyUserId = replyUser.id;\n      this.commentAddModal.form.value = `@${replyUser.nickname} `;\n      this.$refs.commentInput.focus();\n    },\n  },\n  mounted() {\n    this.getMomentPage(this.param);\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.container {\n  width: 1140px;\n  margin: 20px auto;\n  padding: 5px;\n\n  .moment-list {\n    margin: 15px auto 25px;\n    column-count: 3;\n\n    .moment-item {\n      break-inside: avoid;\n      padding: 7px;\n\n      .moment-item-wrapper {\n        padding: 20px 20px 5px 20px;\n\n        .moment-avatar {\n          height: 50px;\n          width: 50px;\n        }\n      }\n\n      .moment-image-group {\n        margin-top: 15px;\n      }\n\n      .moment-time {\n        margin-top: -10px;\n        margin-left: 55px;\n      }\n\n      .moment-content {\n        margin-left: 55px;\n      }\n\n      .moment-button {\n        margin-left: 5px;\n      }\n    }\n  }\n}\n\n.comment-group {\n  max-height: 600px;\n  overflow: auto;\n}\n</style>\n"]}]}