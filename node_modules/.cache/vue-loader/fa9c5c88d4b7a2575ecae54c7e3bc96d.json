{"remainingRequest":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/src/views/second-hand/SecondHand.vue?vue&type=style&index=0&id=6bb469f8&lang=less&scoped=true","dependencies":[{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/src/views/second-hand/SecondHand.vue","mtime":1712673874292},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/css-loader/index.js","mtime":1712590522695},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1712590523760},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/postcss-loader/src/index.js","mtime":1712590523260},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/less-loader/dist/cjs.js","mtime":1712590524064},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/cache-loader/dist/cjs.js","mtime":1712590523146},{"path":"/Users/gaoxiangqing/Documents/gaoxiangqing/smilcool/smilcool-client/node_modules/vue-loader/lib/index.js","mtime":1712590523434}],"contextDependencies":[],"result":["\n.container {\n  width: 1200px;\n  margin: 10px auto;\n  padding: 5px;\n  overflow-x: hidden;\n\n  .ivu-col {\n    padding: 5px;\n  }\n\n  .second-hand-message {\n    margin-top: 7px;\n  }\n\n  .second-hand-menu {\n    .second-hand-category {\n      padding-left: 0;\n      padding-bottom: 0;\n\n      .label {\n        padding: 12px 15px;\n        font-size: 1em;\n        margin: 0 7px 7px 0;\n      }\n    }\n\n    .second-hand-add {\n      padding-right: 0;\n\n      .button {\n        padding: 12px;\n      }\n    }\n  }\n\n  .second-hand-list {\n    margin: 15px auto 0;\n    padding: 1px;\n    width: 1230px;\n    overflow: auto;\n\n    .second-hand-card {\n      width: 216px;\n      height: 373px;\n      overflow: auto;\n      margin: 0 27px 27px 0;\n      float: left;\n\n      .second-hand-image {\n        width: 216px;\n        height: 216px;\n      }\n\n      a.second-hand-title {\n        color: #2f2f2f;\n      }\n\n      a.second-hand-title:hover {\n        color: #FF8364;\n      }\n    }\n\n    .header,\n    .second-hand-description {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .header {\n      font-size: 1em;\n    }\n\n    .second-hand-description {\n      font-size: 0.9em;\n      margin-bottom: 10px;\n    }\n\n    .second-hand-price {\n      display: inline-block;\n      color: red;\n      font-size: 1.1em;\n      padding-top: 5px\n    }\n  }\n}\n\n.ivu-input-number {\n  width: 100%;\n}\n",{"version":3,"sources":["SecondHand.vue"],"names":[],"mappings":";AA6YA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"SecondHand.vue","sourceRoot":"src/views/second-hand","sourcesContent":["<template>\n  <div class=\"container\">\n    <!-- 提示 -->\n    <sui-message class=\"second-hand-message\" dismissable warning>\n      <sui-message-header>\n        <sui-icon name=\"shopping cart\"/>\n        欢迎来到校园跳蚤市场\n      </sui-message-header>\n      <p>在这里，你可以搜罗全校同学贩卖的好物，也可以发布自己闲置的物品，赚取可观的零花钱。</p>\n    </sui-message>\n    <!-- 提示 END -->\n    <!-- 菜单 -->\n    <Row class=\"second-hand-menu\">\n      <iCol class=\"second-hand-category\" span=\"15\">\n        <a is=\"sui-label\" v-if=\"activeSecondHandCategory === '所有'\" color=\"orange\" @click=\"selectCategory('所有')\">\n          所有\n        </a>\n        <a is=\"sui-label\" v-else @click=\"selectCategory('所有')\">所有</a>\n        <template v-for=\"item in secondHandCategory\">\n          <a is=\"sui-label\" v-if=\"activeSecondHandCategory === item.name\" color=\"orange\"\n             @click=\"selectCategory(item.name)\">{{item.name}}</a>\n          <a is=\"sui-label\" v-else @click=\"selectCategory(item.name)\">{{item.name}}</a>\n        </template>\n      </iCol>\n      <iCol span=\"6\">\n        <sui-input class=\"fluid\" placeholder=\"搜好物\" icon=\"search\"\n                   v-model=\"param.general\" @keydown.enter=\"getSecondHandPage(param)\"/>\n      </iCol>\n      <iCol class=\"second-hand-add\" span=\"3\">\n        <sui-button fluid color=\"orange\" content=\"发布闲置\" @click=\"secondHanAddModal.show = true\"/>\n      </iCol>\n    </Row>\n    <!-- 菜单 END -->\n    <!-- 二手列表 -->\n    <div class=\"second-hand-list\">\n      <sui-card class=\"fluid second-hand-card\" v-for=\"secondHand in secondHandPage.records\" :key=\"secondHand.id\">\n        <sui-image class=\"second-hand-image\" :src=\"secondHand.images[0]\"/>\n        <sui-card-content>\n          <sui-card-header>\n            <router-link class=\"second-hand-title\" :to=\"'/second-hand/' + secondHand.id\">{{secondHand.title}}\n            </router-link>\n          </sui-card-header>\n          <sui-card-description class=\"second-hand-description\">{{secondHand.description}}</sui-card-description>\n          <span class=\"second-hand-price\">￥{{secondHand.price}}</span>\n          <span slot=\"right\">\n              <a is=\"sui-label\" basic @click=\"addZan(secondHand.resource)\">👍 {{secondHand.resource.zanCount}}</a>\n              <a is=\"sui-label\" basic @click=\"getCommentList(secondHand.resource)\">\n                💬 {{secondHand.resource.commentCount}}\n              </a>\n            </span>\n\n        </sui-card-content>\n        <sui-card-content extra>\n          <sui-image :src=\"secondHand.user.avatar\" avatar/>\n          <span style=\"line-height: 28px\">{{secondHand.user.nickname}}</span>\n          <span slot=\"right\" style=\"line-height: 28px\"><Time :time=\"secondHand.createTime\"/></span>\n        </sui-card-content>\n      </sui-card>\n    </div>\n    <!-- 二手列表 END -->\n    <!-- 加载更多 -->\n    <sui-button class=\"fluid\" basic content=\"加载更多\" :disabled=\"this.param.current >= this.secondHandPage.pages\"\n                @click=\"loadMore\"/>\n    <!-- 加载更多 END -->\n    <!-- 二手交易添加模态框 -->\n    <Modal v-model=\"secondHanAddModal.show\" title=\"发布闲置\" width=\"600\" scrollable>\n      <Form :model=\"secondHanAddModal.form\" :label-width=\"50\">\n        <FormItem label=\"类别\" required>\n          <Select v-model=\"secondHanAddModal.form.secondHandCategory\" size=\"large\">\n            <Option v-for=\"item in secondHandCategory\" :key=\"item.name\" :value=\"item.name\" :label=\"item.name\"/>\n          </Select>\n        </FormItem>\n        <FormItem label=\"标题\" required>\n          <Input v-model=\"secondHanAddModal.form.title\" size=\"large\" placeholder=\"清晰的标题能让更多人注意到\"/>\n        </FormItem>\n        <FormItem label=\"物品\" required>\n          <Input v-model=\"secondHanAddModal.form.name\" size=\"large\" placeholder=\"请填写物品名\"/>\n        </FormItem>\n        <FormItem label=\"价格\" required>\n          <InputNumber v-model=\"secondHanAddModal.form.price\" :min=\"0\" size=\"large\" placeholder=\"请输入物品价格\"/>\n        </FormItem>\n        <FormItem label=\"地点\" required>\n          <Input v-model=\"secondHanAddModal.form.address\" size=\"large\" placeholder=\"请填写交易地点\"/>\n        </FormItem>\n        <FormItem label=\"描述\" required>\n          <Input v-model=\"secondHanAddModal.form.description\" type=\"textarea\" size=\"large\"\n                 :autosize=\"{minRows: 5,maxRows: 10}\" placeholder=\"输入描述信息，有助于他人了解\"/>\n        </FormItem>\n        <FormItem label=\"图片\" style=\"margin-bottom: 0\" required>\n          <ImageUploader ref=\"imageUploader\" @images-change=\"images => secondHanAddModal.form.images = images\"/>\n        </FormItem>\n      </Form>\n      <template #footer>\n        <Button type=\"text\" @click=\"secondHanAddModal.show = false\">取消</Button>\n        <Button @click=\"addSecondHand\">确定发布</Button>\n      </template>\n    </Modal>\n    <!-- 二手交易添加模态框 END -->\n    <!-- 二手交易详情模态框 -->\n    <Modal v-model=\"commentAddModal.show\" title=\"物品详情\" width=\"600\" footer-hide>\n      <Input ref=\"commentInput\" v-model=\"commentAddModal.form.value\" type=\"textarea\" :rows=\"3\" placeholder=\"添加评论\"\n             @on-enter=\"addComment\"/>\n      <sui-comment-group class=\"comment-group\">\n        <sui-comment v-for=\"comment in commentList\" :key=\"comment.id\">\n          <sui-comment-avatar :src=\"comment.postUser.avatar\"/>\n          <sui-comment-content>\n            <a is=\"sui-comment-author\">{{comment.postUser.nickname}}</a>\n            <sui-comment-metadata>\n              <Time :time=\"comment.createTime\"/>\n            </sui-comment-metadata>\n            <sui-comment-text>{{comment.content}}</sui-comment-text>\n            <sui-comment-actions>\n              <sui-comment-action @click=\"replyComment(comment.id, comment.postUser)\">回复</sui-comment-action>\n            </sui-comment-actions>\n          </sui-comment-content>\n          <!-- 子评论 -->\n          <sui-comment-group v-if=\"comment.children.length > 0\">\n            <sui-comment v-for=\"child in comment.children\" :key=\"child.id\">\n              <sui-comment-avatar :src=\"child.postUser.avatar\"/>\n              <sui-comment-content>\n                <a is=\"sui-comment-author\">{{child.postUser.nickname}}</a>\n                <sui-comment-metadata>\n                  <Time :time=\"child.createTime\"/>\n                </sui-comment-metadata>\n                <sui-comment-text>\n                  <a :href=\"child.replyUser.id\">@{{child.replyUser.nickname}}</a>\n                  {{child.content}}\n                </sui-comment-text>\n                <sui-comment-actions>\n                  <sui-comment-action @click=\"replyComment(comment.id, child.postUser)\">回复</sui-comment-action>\n                </sui-comment-actions>\n              </sui-comment-content>\n            </sui-comment>\n          </sui-comment-group>\n          <!-- 子评论 END -->\n        </sui-comment>\n      </sui-comment-group>\n    </Modal>\n    <!-- 二手交易详情模态框 END -->\n  </div>\n</template>\n\n<script>\nimport ImageUploader from '@/components/common/ImageUploader'\n\nexport default {\n  name: 'SecondHand',\n  components: {\n    ImageUploader\n  },\n  data() {\n    return {\n      activeSecondHandCategory: '所有',\n      secondHandCategory: [{\n        'name': '测试',\n        'code': '-1'\n      }],\n      secondHanAddModal: {\n        show: false,\n        form: {\n          'secondHandCategory': '',\n          'title': '',\n          'name': '',\n          'price': 0,\n          'description': '',\n          'address': '',\n          'images': ''\n        }\n      },\n      param: {\n        // query 参数\n        secondHandCategory: null,\n        general: null,\n        // page & order 参数\n        desc: 'create_time',\n        current: 1\n      },\n      secondHandPage: {\n        'records': [\n          {\n            'id': 1,\n            'userId': 1,\n            'resourceId': 37,\n            'secondHandCategory': '数码',\n            'title': '小米手机9，低价转',\n            'name': '小米手机9',\n            'price': 599,\n            'address': '文瀛13#105',\n            'description': '买了华为P30，这部小米手机就低价转了，9.5成新',\n            'images': ['https://g-search2.alicdn.com/img/bao/uploaded/i4/i2/1714128138/O1CN018kA6uv29zFiGLMEsL_!!0-item_pic.jpg_250x250.jpg'],\n            'createTime': '2024-05-23 15:56:27',\n            'user': {\n              'id': 1,\n              'username': 'admin',\n              'nickname': '管理员',\n              'avatar': 'http://img.angus-liu.cn/avatar/avatar07.png',\n              'sign': '一句话介绍自己'\n            },\n            'resource': {\n              'id': 37,\n              'zanCount': 0,\n              'pvCount': 0,\n              'commentCount': 0\n            }\n          }\n        ],\n        'total': 20,\n        'size': 1,\n        'current': 1,\n        'searchCount': true,\n        'pages': 20\n      },\n      commentList: [{\n        id: -1,\n        content: '测试评论',\n        createTime: '2024-05-21 20:15:39',\n        postUser: {\n          id: -1,\n          username: 'admin',\n          nickname: '管理员',\n          avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n        },\n        children: [\n          {\n            id: -2,\n            content: '测试回复',\n            createTime: '2024-05-21 20:15:46',\n            postUser: {\n              id: 1,\n              username: 'admin',\n              nickname: '管理员',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            },\n            replyUser: {\n              id: 1,\n              username: 'admin',\n              nickname: '管理员',\n              avatar: 'http://img.angus-liu.cn/avatar/avatar07.png'\n            }\n          }\n        ]\n      }],\n      commentAddModal: {\n        show: false,\n        form: {\n          parentId: null,\n          resourceId: null,\n          replyUserId: null,\n          value: '',\n          content: ''\n        }\n      },\n      currentResource: {}\n    }\n  },\n  methods: {\n    // 类别切换\n    selectCategory(secondHandCategory) {\n      this.activeSecondHandCategory = secondHandCategory;\n      if (secondHandCategory === '所有') {\n        this.param.secondHandCategory = null;\n      } else {\n        this.param.secondHandCategory = secondHandCategory;\n      }\n      this.param.current = 1;\n      this.getSecondHandPage(this.param);\n    },\n    // 初始化二手交易添加模态框\n    resetSecondHanAddModal() {\n      this.secondHanAddModal = {\n        show: false,\n        form: {\n          'secondHandCategory': '',\n          'title': '',\n          'name': '',\n          'price': 0,\n          'description': '',\n          'address': '',\n          'images': ''\n        }\n      };\n      this.$refs.imageUploader.clearImages();\n    },\n    // 获取二手交易类别\n    getSecondHandCategory() {\n      this.$axios.get('/api/dic/item', { dicTypeCode: 'second-hand-category' })\n        .then(res => {\n          let result = res.data;\n          this.secondHandCategory = result.data;\n        })\n    },\n    // 获取二手交易分页\n    getSecondHandPage(param) {\n      this.$axios.get('/api/second-hand/page', param)\n        .then(res => {\n          let result = res.data;\n          this.secondHandPage = result.data;\n          this.secondHandPage.records.forEach(secondHand => {\n            if (secondHand.images && secondHand.images.length > 0) {\n              secondHand.images = JSON.parse(secondHand.images);\n            }\n          });\n        });\n    },\n    // 添加二手交易\n    addSecondHand() {\n      let secondHandForm = this.secondHanAddModal.form;\n      secondHandForm.images = JSON.stringify(secondHandForm.images);\n      this.$axios.post('/api/second-hand', secondHandForm)\n        .then(res => {\n          let result = res.data;\n          if (result.success) {\n            this.$Notice.success({ title: 'Bingo', desc: '发布成功' });\n            this.resetSecondHanAddModal();\n            this.getSecondHandPage(this.param);\n          }\n        });\n    },\n    // 加载更多\n    loadMore() {\n      this.param.current++;\n      this.$axios.get('/api/second-hand/page', this.param)\n        .then(res => {\n          let result = res.data;\n          let moreSecondHandPage = result.data;\n          moreSecondHandPage.records.forEach(secondHand => {\n            if (secondHand.images && secondHand.images.length > 0) {\n              secondHand.images = JSON.parse(secondHand.images);\n            }\n          });\n          this.secondHandPage.records.push(...moreSecondHandPage.records);\n        });\n    },\n    // 点赞\n    addZan(resource) {\n      this.$axios.post('/api/zan', { resourceId: resource.id })\n        .then(res => resource.zanCount++);\n    },\n    // 获取评论\n    getCommentList(resource) {\n      this.currentResource = resource;\n      this.$axios.get(`/api/comment/${resource.id}`)\n        .then(res => {\n          let result = res.data;\n          this.commentList = result.data;\n          // 展示评论\n          this.commentAddModal.show = true;\n        });\n    },\n    // 初始化评论\n    initComment() {\n      this.commentAddModal.form = {\n        resourceId: null,\n        parentId: null,\n        replyUserId: null,\n        value: '',\n        content: ''\n      }\n    },\n    // 添加评论\n    addComment() {\n      // 设置资源 ID\n      this.commentAddModal.form.resourceId = this.currentResource.id;\n      // 判断是评论还是回复\n      if (this.commentAddModal.form.value.startsWith('@')\n        && this.commentAddModal.form.replyUserId !== null) {\n        // 回复时去掉评论内容中的回复用户名\n        let index = this.commentAddModal.form.value.indexOf(' ');\n        this.commentAddModal.form.content = this.commentAddModal.form.value.substr(index + 1);\n      } else {\n        this.commentAddModal.form.parentId = null;\n        this.commentAddModal.form.replyUserId = null;\n        this.commentAddModal.form.content = this.commentAddModal.form.value;\n      }\n      this.$axios.post('/api/comment', this.commentAddModal.form)\n        .then(res => {\n          this.initComment();\n          this.currentResource.commentCount++;\n          this.getCommentList(this.currentResource);\n        });\n    },\n    // 回复评论\n    replyComment(parentId, replyUser) {\n      this.commentAddModal.form.parentId = parentId;\n      this.commentAddModal.form.replyUserId = replyUser.id;\n      this.commentAddModal.form.value = `@${replyUser.nickname} `;\n      this.$refs.commentInput.focus();\n    }\n  },\n  mounted() {\n    this.getSecondHandCategory();\n    this.getSecondHandPage(this.param);\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.container {\n  width: 1200px;\n  margin: 10px auto;\n  padding: 5px;\n  overflow-x: hidden;\n\n  .ivu-col {\n    padding: 5px;\n  }\n\n  .second-hand-message {\n    margin-top: 7px;\n  }\n\n  .second-hand-menu {\n    .second-hand-category {\n      padding-left: 0;\n      padding-bottom: 0;\n\n      .label {\n        padding: 12px 15px;\n        font-size: 1em;\n        margin: 0 7px 7px 0;\n      }\n    }\n\n    .second-hand-add {\n      padding-right: 0;\n\n      .button {\n        padding: 12px;\n      }\n    }\n  }\n\n  .second-hand-list {\n    margin: 15px auto 0;\n    padding: 1px;\n    width: 1230px;\n    overflow: auto;\n\n    .second-hand-card {\n      width: 216px;\n      height: 373px;\n      overflow: auto;\n      margin: 0 27px 27px 0;\n      float: left;\n\n      .second-hand-image {\n        width: 216px;\n        height: 216px;\n      }\n\n      a.second-hand-title {\n        color: #2f2f2f;\n      }\n\n      a.second-hand-title:hover {\n        color: #FF8364;\n      }\n    }\n\n    .header,\n    .second-hand-description {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .header {\n      font-size: 1em;\n    }\n\n    .second-hand-description {\n      font-size: 0.9em;\n      margin-bottom: 10px;\n    }\n\n    .second-hand-price {\n      display: inline-block;\n      color: red;\n      font-size: 1.1em;\n      padding-top: 5px\n    }\n  }\n}\n\n.ivu-input-number {\n  width: 100%;\n}\n</style>\n"]}]}